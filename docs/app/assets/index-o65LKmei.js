(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var we,S,Wt,le,vt,zt,qt,Yt,Xe,Ve,Je,Gt,Ce={},Kt=[],zn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Se=Array.isArray;function G(e,t){for(var n in t)e[n]=t[n];return e}function Ze(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function K(e,t,n){var o,s,r,i={};for(r in t)r=="key"?o=t[r]:r=="ref"?s=t[r]:i[r]=t[r];if(arguments.length>2&&(i.children=arguments.length>3?we.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(r in e.defaultProps)i[r]===void 0&&(i[r]=e.defaultProps[r]);return be(e,i,o,s,null)}function be(e,t,n,o,s){var r={type:e,props:t,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++Wt,__i:-1,__u:0};return s==null&&S.vnode!=null&&S.vnode(r),r}function Xt(){return{current:null}}function M(e){return e.children}function q(e,t){this.props=e,this.context=t}function _e(e,t){if(t==null)return e.__?_e(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?_e(e):null}function Zt(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Zt(e)}}function We(e){(!e.__d&&(e.__d=!0)&&le.push(e)&&!Te.__r++||vt!=S.debounceRendering)&&((vt=S.debounceRendering)||zt)(Te)}function Te(){for(var e,t,n,o,s,r,i,c=1;le.length;)le.length>c&&le.sort(qt),e=le.shift(),c=le.length,e.__d&&(n=void 0,o=void 0,s=(o=(t=e).__v).__e,r=[],i=[],t.__P&&((n=G({},o)).__v=o.__v+1,S.vnode&&S.vnode(n),Qe(t.__P,n,o,t.__n,t.__P.namespaceURI,32&o.__u?[s]:null,r,s??_e(o),!!(32&o.__u),i),n.__v=o.__v,n.__.__k[n.__i]=n,tn(r,n,i),o.__e=o.__=null,n.__e!=s&&Zt(n)));Te.__r=0}function Qt(e,t,n,o,s,r,i,c,p,d,f){var a,u,_,b,j,h,C,w=o&&o.__k||Kt,P=t.length;for(p=qn(n,t,w,p,P),a=0;a<P;a++)(_=n.__k[a])!=null&&(u=_.__i==-1?Ce:w[_.__i]||Ce,_.__i=a,h=Qe(e,_,u,s,r,i,c,p,d,f),b=_.__e,_.ref&&u.ref!=_.ref&&(u.ref&&et(u.ref,null,_),f.push(_.ref,_.__c||b,_)),j==null&&b!=null&&(j=b),(C=!!(4&_.__u))||u.__k===_.__k?p=en(_,p,e,C):typeof _.type=="function"&&h!==void 0?p=h:b&&(p=b.nextSibling),_.__u&=-7);return n.__e=j,p}function qn(e,t,n,o,s){var r,i,c,p,d,f=n.length,a=f,u=0;for(e.__k=new Array(s),r=0;r<s;r++)(i=t[r])!=null&&typeof i!="boolean"&&typeof i!="function"?(p=r+u,(i=e.__k[r]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?be(null,i,null,null,null):Se(i)?be(M,{children:i},null,null,null):i.constructor==null&&i.__b>0?be(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=e,i.__b=e.__b+1,c=null,(d=i.__i=Yn(i,n,p,a))!=-1&&(a--,(c=n[d])&&(c.__u|=2)),c==null||c.__v==null?(d==-1&&(s>f?u--:s<f&&u++),typeof i.type!="function"&&(i.__u|=4)):d!=p&&(d==p-1?u--:d==p+1?u++:(d>p?u--:u++,i.__u|=4))):e.__k[r]=null;if(a)for(r=0;r<f;r++)(c=n[r])!=null&&!(2&c.__u)&&(c.__e==o&&(o=_e(c)),on(c,c));return o}function en(e,t,n,o){var s,r;if(typeof e.type=="function"){for(s=e.__k,r=0;s&&r<s.length;r++)s[r]&&(s[r].__=e,t=en(s[r],t,n,o));return t}e.__e!=t&&(o&&(t&&e.type&&!t.parentNode&&(t=_e(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Z(e,t){return t=t||[],e==null||typeof e=="boolean"||(Se(e)?e.some(function(n){Z(n,t)}):t.push(e)),t}function Yn(e,t,n,o){var s,r,i,c=e.key,p=e.type,d=t[n],f=d!=null&&(2&d.__u)==0;if(d===null&&e.key==null||f&&c==d.key&&p==d.type)return n;if(o>(f?1:0)){for(s=n-1,r=n+1;s>=0||r<t.length;)if((d=t[i=s>=0?s--:r++])!=null&&!(2&d.__u)&&c==d.key&&p==d.type)return i}return-1}function yt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||zn.test(t)?n:n+"px"}function $e(e,t,n,o,s){var r,i;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof o=="string"&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||yt(e.style,t,"");if(n)for(t in n)o&&n[t]==o[t]||yt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(Yt,"$1")),i=t.toLowerCase(),t=i in e||t=="onFocusOut"||t=="onFocusIn"?i.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?o?n.u=o.u:(n.u=Xe,e.addEventListener(t,r?Je:Ve,r)):e.removeEventListener(t,r?Je:Ve,r);else{if(s=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function gt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=Xe++;else if(t.t<n.u)return;return n(S.event?S.event(t):t)}}}function Qe(e,t,n,o,s,r,i,c,p,d){var f,a,u,_,b,j,h,C,w,P,O,R,U,A,N,k,m,y=t.type;if(t.constructor!=null)return null;128&n.__u&&(p=!!(32&n.__u),r=[c=t.__e=n.__e]),(f=S.__b)&&f(t);e:if(typeof y=="function")try{if(C=t.props,w="prototype"in y&&y.prototype.render,P=(f=y.contextType)&&o[f.__c],O=f?P?P.props.value:f.__:o,n.__c?h=(a=t.__c=n.__c).__=a.__E:(w?t.__c=a=new y(C,O):(t.__c=a=new q(C,O),a.constructor=y,a.render=Kn),P&&P.sub(a),a.props=C,a.state||(a.state={}),a.context=O,a.__n=o,u=a.__d=!0,a.__h=[],a._sb=[]),w&&a.__s==null&&(a.__s=a.state),w&&y.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=G({},a.__s)),G(a.__s,y.getDerivedStateFromProps(C,a.__s))),_=a.props,b=a.state,a.__v=t,u)w&&y.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),w&&a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(w&&y.getDerivedStateFromProps==null&&C!==_&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(C,O),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(C,a.__s,O)===!1||t.__v==n.__v){for(t.__v!=n.__v&&(a.props=C,a.state=a.__s,a.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(x){x&&(x.__=t)}),R=0;R<a._sb.length;R++)a.__h.push(a._sb[R]);a._sb=[],a.__h.length&&i.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(C,a.__s,O),w&&a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(_,b,j)})}if(a.context=O,a.props=C,a.__P=e,a.__e=!1,U=S.__r,A=0,w){for(a.state=a.__s,a.__d=!1,U&&U(t),f=a.render(a.props,a.state,a.context),N=0;N<a._sb.length;N++)a.__h.push(a._sb[N]);a._sb=[]}else do a.__d=!1,U&&U(t),f=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++A<25);a.state=a.__s,a.getChildContext!=null&&(o=G(G({},o),a.getChildContext())),w&&!u&&a.getSnapshotBeforeUpdate!=null&&(j=a.getSnapshotBeforeUpdate(_,b)),k=f,f!=null&&f.type===M&&f.key==null&&(k=nn(f.props.children)),c=Qt(e,Se(k)?k:[k],t,n,o,s,r,i,c,p,d),a.base=t.__e,t.__u&=-161,a.__h.length&&i.push(a),h&&(a.__E=a.__=null)}catch(x){if(t.__v=null,p||r!=null)if(x.then){for(t.__u|=p?160:128;c&&c.nodeType==8&&c.nextSibling;)c=c.nextSibling;r[r.indexOf(c)]=null,t.__e=c}else{for(m=r.length;m--;)Ze(r[m]);ze(t)}else t.__e=n.__e,t.__k=n.__k,x.then||ze(t);S.__e(x,t,n)}else r==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):c=t.__e=Gn(n.__e,t,n,o,s,r,i,p,d);return(f=S.diffed)&&f(t),128&t.__u?void 0:c}function ze(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(ze)}function tn(e,t,n){for(var o=0;o<n.length;o++)et(n[o],n[++o],n[++o]);S.__c&&S.__c(t,e),e.some(function(s){try{e=s.__h,s.__h=[],e.some(function(r){r.call(s)})}catch(r){S.__e(r,s.__v)}})}function nn(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:Se(e)?e.map(nn):G({},e)}function Gn(e,t,n,o,s,r,i,c,p){var d,f,a,u,_,b,j,h=n.props,C=t.props,w=t.type;if(w=="svg"?s="http://www.w3.org/2000/svg":w=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),r!=null){for(d=0;d<r.length;d++)if((_=r[d])&&"setAttribute"in _==!!w&&(w?_.localName==w:_.nodeType==3)){e=_,r[d]=null;break}}if(e==null){if(w==null)return document.createTextNode(C);e=document.createElementNS(s,w,C.is&&C),c&&(S.__m&&S.__m(t,r),c=!1),r=null}if(w==null)h===C||c&&e.data==C||(e.data=C);else{if(r=r&&we.call(e.childNodes),h=n.props||Ce,!c&&r!=null)for(h={},d=0;d<e.attributes.length;d++)h[(_=e.attributes[d]).name]=_.value;for(d in h)if(_=h[d],d!="children"){if(d=="dangerouslySetInnerHTML")a=_;else if(!(d in C)){if(d=="value"&&"defaultValue"in C||d=="checked"&&"defaultChecked"in C)continue;$e(e,d,null,_,s)}}for(d in C)_=C[d],d=="children"?u=_:d=="dangerouslySetInnerHTML"?f=_:d=="value"?b=_:d=="checked"?j=_:c&&typeof _!="function"||h[d]===_||$e(e,d,_,h[d],s);if(f)c||a&&(f.__html==a.__html||f.__html==e.innerHTML)||(e.innerHTML=f.__html),t.__k=[];else if(a&&(e.innerHTML=""),Qt(t.type=="template"?e.content:e,Se(u)?u:[u],t,n,o,w=="foreignObject"?"http://www.w3.org/1999/xhtml":s,r,i,r?r[0]:n.__k&&_e(n,0),c,p),r!=null)for(d=r.length;d--;)Ze(r[d]);c||(d="value",w=="progress"&&b==null?e.removeAttribute("value"):b!=null&&(b!==e[d]||w=="progress"&&!b||w=="option"&&b!=h[d])&&$e(e,d,b,h[d],s),d="checked",j!=null&&j!=e[d]&&$e(e,d,j,h[d],s))}return e}function et(e,t,n){try{if(typeof e=="function"){var o=typeof e.__u=="function";o&&e.__u(),o&&t==null||(e.__u=e(t))}else e.current=t}catch(s){S.__e(s,n)}}function on(e,t,n){var o,s;if(S.unmount&&S.unmount(e),(o=e.ref)&&(o.current&&o.current!=e.__e||et(o,null,t)),(o=e.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(r){S.__e(r,t)}o.base=o.__P=null}if(o=e.__k)for(s=0;s<o.length;s++)o[s]&&on(o[s],t,n||typeof e.type!="function");n||Ze(e.__e),e.__c=e.__=e.__e=void 0}function Kn(e,t,n){return this.constructor(e,n)}function fe(e,t,n){var o,s,r,i;t==document&&(t=document.documentElement),S.__&&S.__(e,t),s=(o=typeof n=="function")?null:n&&n.__k||t.__k,r=[],i=[],Qe(t,e=(!o&&n||t).__k=K(M,null,[e]),s||Ce,Ce,t.namespaceURI,!o&&n?[n]:s?null:t.firstChild?we.call(t.childNodes):null,r,!o&&n?n:s?s.__e:t.firstChild,o,i),tn(r,e,i)}function sn(e,t){fe(e,t,sn)}function Xn(e,t,n){var o,s,r,i,c=G({},e.props);for(r in e.type&&e.type.defaultProps&&(i=e.type.defaultProps),t)r=="key"?o=t[r]:r=="ref"?s=t[r]:c[r]=t[r]===void 0&&i!=null?i[r]:t[r];return arguments.length>2&&(c.children=arguments.length>3?we.call(arguments,2):n),be(e.type,c,o||e.key,s||e.ref,null)}function rn(e){function t(n){var o,s;return this.getChildContext||(o=new Set,(s={})[t.__c]=this,this.getChildContext=function(){return s},this.componentWillUnmount=function(){o=null},this.shouldComponentUpdate=function(r){this.props.value!=r.value&&o.forEach(function(i){i.__e=!0,We(i)})},this.sub=function(r){o.add(r);var i=r.componentWillUnmount;r.componentWillUnmount=function(){o&&o.delete(r),i&&i.call(r)}}),n.children}return t.__c="__cC"+Gt++,t.__=e,t.Provider=t.__l=(t.Consumer=function(n,o){return n.children(o)}).contextType=t,t}we=Kt.slice,S={__e:function(e,t,n,o){for(var s,r,i;t=t.__;)if((s=t.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(e)),i=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(e,o||{}),i=s.__d),i)return s.__E=s}catch(c){e=c}throw e}},Wt=0,q.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=G({},this.state),typeof e=="function"&&(e=e(G({},n),this.props)),e&&G(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),We(this))},q.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),We(this))},q.prototype.render=M,le=[],zt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,qt=function(e,t){return e.__v.__b-t.__v.__b},Te.__r=0,Yt=/(PointerCapture)$|Capture$/i,Xe=0,Ve=gt(!1),Je=gt(!0),Gt=0;var Zn=0;function l(e,t,n,o,s,r){t||(t={});var i,c,p=t;if("ref"in p)for(c in p={},t)c=="ref"?i=t[c]:p[c]=t[c];var d={type:e,props:p,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Zn,__i:-1,__u:0,__source:s,__self:r};if(typeof e=="function"&&(i=e.defaultProps))for(c in i)p[c]===void 0&&(p[c]=i[c]);return S.vnode&&S.vnode(d),d}var Q,T,Ae,bt,me=0,ln=[],L=S,xt=L.__b,Ct=L.__r,wt=L.diffed,St=L.__c,kt=L.unmount,jt=L.__;function ie(e,t){L.__h&&L.__h(T,e,me||t),me=0;var n=T.__H||(T.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function D(e){return me=1,Ie(cn,e)}function Ie(e,t,n){var o=ie(Q++,2);if(o.t=e,!o.__c&&(o.__=[n?n(t):cn(void 0,t),function(c){var p=o.__N?o.__N[0]:o.__[0],d=o.t(p,c);p!==d&&(o.__N=[d,o.__[1]],o.__c.setState({}))}],o.__c=T,!T.__f)){var s=function(c,p,d){if(!o.__c.__H)return!0;var f=o.__c.__H.__.filter(function(u){return!!u.__c});if(f.every(function(u){return!u.__N}))return!r||r.call(this,c,p,d);var a=o.__c.props!==c;return f.forEach(function(u){if(u.__N){var _=u.__[0];u.__=u.__N,u.__N=void 0,_!==u.__[0]&&(a=!0)}}),r&&r.call(this,c,p,d)||a};T.__f=!0;var r=T.shouldComponentUpdate,i=T.componentWillUpdate;T.componentWillUpdate=function(c,p,d){if(this.__e){var f=r;r=void 0,s(c,p,d),r=f}i&&i.call(this,c,p,d)},T.shouldComponentUpdate=s}return o.__N||o.__}function V(e,t){var n=ie(Q++,3);!L.__s&&lt(n.__H,t)&&(n.__=e,n.u=t,T.__H.__h.push(n))}function ye(e,t){var n=ie(Q++,4);!L.__s&&lt(n.__H,t)&&(n.__=e,n.u=t,T.__h.push(n))}function ce(e){return me=5,ke(function(){return{current:e}},[])}function tt(e,t,n){me=6,ye(function(){if(typeof e=="function"){var o=e(t());return function(){e(null),o&&typeof o=="function"&&o()}}if(e)return e.current=t(),function(){return e.current=null}},n==null?n:n.concat(e))}function ke(e,t){var n=ie(Q++,7);return lt(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function nt(e,t){return me=8,ke(function(){return e},t)}function ot(e){var t=T.context[e.__c],n=ie(Q++,9);return n.c=e,t?(n.__==null&&(n.__=!0,t.sub(T)),t.props.value):e.__}function st(e,t){L.useDebugValue&&L.useDebugValue(t?t(e):e)}function Qn(e){var t=ie(Q++,10),n=D();return t.__=e,T.componentDidCatch||(T.componentDidCatch=function(o,s){t.__&&t.__(o,s),n[1](o)}),[n[0],function(){n[1](void 0)}]}function rt(){var e=ie(Q++,11);if(!e.__){for(var t=T.__v;t!==null&&!t.__m&&t.__!==null;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__}function eo(){for(var e;e=ln.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Fe),e.__H.__h.forEach(qe),e.__H.__h=[]}catch(t){e.__H.__h=[],L.__e(t,e.__v)}}L.__b=function(e){T=null,xt&&xt(e)},L.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),jt&&jt(e,t)},L.__r=function(e){Ct&&Ct(e),Q=0;var t=(T=e.__c).__H;t&&(Ae===T?(t.__h=[],T.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(Fe),t.__h.forEach(qe),t.__h=[],Q=0)),Ae=T},L.diffed=function(e){wt&&wt(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(ln.push(t)!==1&&bt===L.requestAnimationFrame||((bt=L.requestAnimationFrame)||to)(eo)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Ae=T=null},L.__c=function(e,t){t.some(function(n){try{n.__h.forEach(Fe),n.__h=n.__h.filter(function(o){return!o.__||qe(o)})}catch(o){t.some(function(s){s.__h&&(s.__h=[])}),t=[],L.__e(o,n.__v)}}),St&&St(e,t)},L.unmount=function(e){kt&&kt(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{Fe(o)}catch(s){t=s}}),n.__H=void 0,t&&L.__e(t,n.__v))};var Et=typeof requestAnimationFrame=="function";function to(e){var t,n=function(){clearTimeout(o),Et&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,35);Et&&(t=requestAnimationFrame(n))}function Fe(e){var t=T,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),T=t}function qe(e){var t=T;e.__c=e.__(),T=t}function lt(e,t){return!e||e.length!==t.length||t.some(function(n,o){return n!==e[o]})}function cn(e,t){return typeof t=="function"?t(e):t}function Pt(e){const t=new Map;for(const n of e){const o=n.trace_id??"no-trace",s=n.span_id??crypto.randomUUID(),r=n.parent_span_id??null,i=n.timestamp,c=n.event,p=n.level??"info";t.has(o)||t.set(o,{roots:[],nodes:new Map});const d=t.get(o),f=d.nodes.get(s)||{id:s,traceId:o,parentId:r,children:[],depth:0,level:p,msg:c,timestamp:i,raw:[]};!f.msg&&c&&(f.msg=c),!f.timestamp&&i&&(f.timestamp=i),(!f.level||f.level==="info")&&(f.level=p),r&&!f.parentId&&(f.parentId=r),f.raw.push(n),d.nodes.set(s,f)}for(const n of t.values()){const o=new Set;for(const s of n.nodes.values())if(s.parentId){n.nodes.has(s.parentId)||n.nodes.set(s.parentId,{id:s.parentId,traceId:s.traceId,parentId:null,children:[],depth:0,level:"info",msg:`[span ${s.parentId}]`,timestamp:s.timestamp,raw:[]});const r=n.nodes.get(s.parentId);r.children.includes(s.id)||r.children.push(s.id),o.add(s.id)}n.roots=Array.from(n.nodes.keys()).filter(s=>!o.has(s));for(const s of n.nodes.values())s.children.length>1&&s.children.sort((r,i)=>{const c=n.nodes.get(r),p=n.nodes.get(i),d=(c==null?void 0:c.timestamp)||"",f=(p==null?void 0:p.timestamp)||"";return d<f?-1:d>f?1:0})}for(const n of t.values()){const o=new Set,s=(r,i)=>{const c=n.nodes.get(r);!c||o.has(r)||(c.depth=i,o.add(r),c.children.forEach(p=>s(p,i+1)))};n.roots.forEach(r=>s(r,0))}for(const[n,o]of t.entries()){const s=o.roots.length>0?o.nodes.get(o.roots[0]):null;o.name=(s==null?void 0:s.msg)||`Trace ${n}`;let r=null,i=null;for(const c of o.nodes.values())c.timestamp&&((!r||c.timestamp<r)&&(r=c.timestamp),(!i||c.timestamp>i)&&(i=c.timestamp));if(o.startTime=r,o.endTime=i,r&&i){const c=new Date(r).getTime(),p=new Date(i).getTime();o.durationMs=p-c}}return t}const $t={mode:"full",decimalPlaces:3,forceEnUS:!1,showInNodes:!0};function Ye(e,t,n){if(!e||t.mode==="hidden")return"";try{const o=new Date(e);switch(t.mode){case"relative":{if(!n)return e;const s=new Date(n).getTime(),i=(o.getTime()-s)/1e3;return`${i>=0?"+":""}${i.toFixed(t.decimalPlaces)}s`}case"time":{const s=t.forceEnUS?"en-US":void 0;return o.toLocaleString(s,{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}case"full":{const s=t.forceEnUS?"en-US":void 0;return o.toLocaleString(s,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3})}default:return e}}catch{return e}}function no(){try{const e=localStorage.getItem("aitrace_timestamp_settings");if(e)return{...$t,...JSON.parse(e)}}catch(e){console.error("Failed to load timestamp settings:",e)}return $t}function oo(e){try{localStorage.setItem("aitrace_timestamp_settings",JSON.stringify(e))}catch(t){console.error("Failed to save timestamp settings:",t)}}const an="aitrace-density-settings",Ft={mode:"comfortable"};function so(){try{const e=localStorage.getItem(an);if(e){const t=JSON.parse(e);return{...Ft,...t}}}catch(e){console.error("Failed to load density settings:",e)}return Ft}function ro(e){try{localStorage.setItem(an,JSON.stringify(e))}catch(t){console.error("Failed to save density settings:",t)}}function lo(e){switch(e){case"compact":return{vertical:"0px",horizontal:"0.125rem"};case"cozy":return{vertical:"0.125rem",horizontal:"0.375rem"};case"comfortable":default:return{vertical:"0.25rem",horizontal:"0.5rem"}}}function io(e){switch(e){case"compact":return"0px 0";case"cozy":return"0.0625rem 0";case"comfortable":default:return"0.125rem 0"}}const co={},Tt=e=>{let t;const n=new Set,o=(f,a)=>{const u=typeof f=="function"?f(t):f;if(!Object.is(u,t)){const _=t;t=a??(typeof u!="object"||u===null)?u:Object.assign({},t,u),n.forEach(b=>b(t,_))}},s=()=>t,p={setState:o,getState:s,getInitialState:()=>d,subscribe:f=>(n.add(f),()=>n.delete(f)),destroy:()=>{(co?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},d=t=e(o,s,p);return p},ao=e=>e?Tt(e):Tt;function un(e,t){for(var n in t)e[n]=t[n];return e}function Ge(e,t){for(var n in e)if(n!=="__source"&&!(n in t))return!0;for(var o in t)if(o!=="__source"&&e[o]!==t[o])return!0;return!1}function it(e,t){var n=t(),o=D({t:{__:n,u:t}}),s=o[0].t,r=o[1];return ye(function(){s.__=n,s.u=t,Me(s)&&r({t:s})},[e,n,t]),V(function(){return Me(s)&&r({t:s}),e(function(){Me(s)&&r({t:s})})},[e]),n}function Me(e){var t,n,o=e.u,s=e.__;try{var r=o();return!((t=s)===(n=r)&&(t!==0||1/t==1/n)||t!=t&&n!=n)}catch{return!0}}function ct(e){e()}function at(e){return e}function ut(){return[!1,ct]}var dt=ye;function De(e,t){this.props=e,this.context=t}function dn(e,t){function n(s){var r=this.props.ref,i=r==s.ref;return!i&&r&&(r.call?r(null):r.current=null),t?!t(this.props,s)||!i:Ge(this.props,s)}function o(s){return this.shouldComponentUpdate=n,K(e,s)}return o.displayName="Memo("+(e.displayName||e.name)+")",o.prototype.isReactComponent=!0,o.__f=!0,o.type=e,o}(De.prototype=new q).isPureReactComponent=!0,De.prototype.shouldComponentUpdate=function(e,t){return Ge(this.props,e)||Ge(this.state,t)};var Dt=S.__b;S.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),Dt&&Dt(e)};var uo=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function pn(e){function t(n){var o=un({},n);return delete o.ref,e(o,n.ref||null)}return t.$$typeof=uo,t.render=e,t.prototype.isReactComponent=t.__f=!0,t.displayName="ForwardRef("+(e.displayName||e.name)+")",t}var It=function(e,t){return e==null?null:Z(Z(e).map(t))},_n={map:It,forEach:It,count:function(e){return e?Z(e).length:0},only:function(e){var t=Z(e);if(t.length!==1)throw"Children.only";return t[0]},toArray:Z},po=S.__e;S.__e=function(e,t,n,o){if(e.then){for(var s,r=t;r=r.__;)if((s=r.__c)&&s.__c)return t.__e==null&&(t.__e=n.__e,t.__k=n.__k),s.__c(e,t)}po(e,t,n,o)};var Lt=S.unmount;function fn(e,t,n){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach(function(o){typeof o.__c=="function"&&o.__c()}),e.__c.__H=null),(e=un({},e)).__c!=null&&(e.__c.__P===n&&(e.__c.__P=t),e.__c.__e=!0,e.__c=null),e.__k=e.__k&&e.__k.map(function(o){return fn(o,t,n)})),e}function mn(e,t,n){return e&&n&&(e.__v=null,e.__k=e.__k&&e.__k.map(function(o){return mn(o,t,n)}),e.__c&&e.__c.__P===t&&(e.__e&&n.appendChild(e.__e),e.__c.__e=!0,e.__c.__P=n)),e}function xe(){this.__u=0,this.o=null,this.__b=null}function hn(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}function vn(e){var t,n,o;function s(r){if(t||(t=e()).then(function(i){n=i.default||i},function(i){o=i}),o)throw o;if(!n)throw t;return K(n,r)}return s.displayName="Lazy",s.__f=!0,s}function pe(){this.i=null,this.l=null}S.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&32&e.__u&&(e.type=null),Lt&&Lt(e)},(xe.prototype=new q).__c=function(e,t){var n=t.__c,o=this;o.o==null&&(o.o=[]),o.o.push(n);var s=hn(o.__v),r=!1,i=function(){r||(r=!0,n.__R=null,s?s(c):c())};n.__R=i;var c=function(){if(!--o.__u){if(o.state.__a){var p=o.state.__a;o.__v.__k[0]=mn(p,p.__c.__P,p.__c.__O)}var d;for(o.setState({__a:o.__b=null});d=o.o.pop();)d.forceUpdate()}};o.__u++||32&t.__u||o.setState({__a:o.__b=o.__v.__k[0]}),e.then(i,i)},xe.prototype.componentWillUnmount=function(){this.o=[]},xe.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var n=document.createElement("div"),o=this.__v.__k[0].__c;this.__v.__k[0]=fn(this.__b,n,o.__O=o.__P)}this.__b=null}var s=t.__a&&K(M,null,e.fallback);return s&&(s.__u&=-33),[K(M,null,t.__a?null:e.children),s]};var Ot=function(e,t,n){if(++n[1]===n[0]&&e.l.delete(t),e.props.revealOrder&&(e.props.revealOrder[0]!=="t"||!e.l.size))for(n=e.i;n;){for(;n.length>3;)n.pop()();if(n[1]<n[0])break;e.i=n=n[2]}};function _o(e){return this.getChildContext=function(){return e.context},e.children}function fo(e){var t=this,n=e.h;if(t.componentWillUnmount=function(){fe(null,t.v),t.v=null,t.h=null},t.h&&t.h!==n&&t.componentWillUnmount(),!t.v){for(var o=t.__v;o!==null&&!o.__m&&o.__!==null;)o=o.__;t.h=n,t.v={nodeType:1,parentNode:n,childNodes:[],__k:{__m:o.__m},contains:function(){return!0},insertBefore:function(s,r){this.childNodes.push(s),t.h.insertBefore(s,r)},removeChild:function(s){this.childNodes.splice(this.childNodes.indexOf(s)>>>1,1),t.h.removeChild(s)}}}fe(K(_o,{context:t.context},e.__v),t.v)}function yn(e,t){var n=K(fo,{__v:e,h:t});return n.containerInfo=t,n}(pe.prototype=new q).__a=function(e){var t=this,n=hn(t.__v),o=t.l.get(e);return o[0]++,function(s){var r=function(){t.props.revealOrder?(o.push(s),Ot(t,e,o)):s()};n?n(r):r()}},pe.prototype.render=function(e){this.i=null,this.l=new Map;var t=Z(e.children);e.revealOrder&&e.revealOrder[0]==="b"&&t.reverse();for(var n=t.length;n--;)this.l.set(t[n],this.i=[1,0,this.i]);return e.children},pe.prototype.componentDidUpdate=pe.prototype.componentDidMount=function(){var e=this;this.l.forEach(function(t,n){Ot(e,n,t)})};var gn=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,mo=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,ho=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,vo=/[A-Z0-9]/g,yo=typeof document<"u",go=function(e){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(e)};function bn(e,t,n){return t.__k==null&&(t.textContent=""),fe(e,t),typeof n=="function"&&n(),e?e.__c:null}function xn(e,t,n){return sn(e,t),typeof n=="function"&&n(),e?e.__c:null}q.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(e){Object.defineProperty(q.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})});var Rt=S.event;function bo(){}function xo(){return this.cancelBubble}function Co(){return this.defaultPrevented}S.event=function(e){return Rt&&(e=Rt(e)),e.persist=bo,e.isPropagationStopped=xo,e.isDefaultPrevented=Co,e.nativeEvent=e};var pt,wo={enumerable:!1,configurable:!0,get:function(){return this.class}},Nt=S.vnode;S.vnode=function(e){typeof e.type=="string"&&function(t){var n=t.props,o=t.type,s={},r=o.indexOf("-")===-1;for(var i in n){var c=n[i];if(!(i==="value"&&"defaultValue"in n&&c==null||yo&&i==="children"&&o==="noscript"||i==="class"||i==="className")){var p=i.toLowerCase();i==="defaultValue"&&"value"in n&&n.value==null?i="value":i==="download"&&c===!0?c="":p==="translate"&&c==="no"?c=!1:p[0]==="o"&&p[1]==="n"?p==="ondoubleclick"?i="ondblclick":p!=="onchange"||o!=="input"&&o!=="textarea"||go(n.type)?p==="onfocus"?i="onfocusin":p==="onblur"?i="onfocusout":ho.test(i)&&(i=p):p=i="oninput":r&&mo.test(i)?i=i.replace(vo,"-$&").toLowerCase():c===null&&(c=void 0),p==="oninput"&&s[i=p]&&(i="oninputCapture"),s[i]=c}}o=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=Z(n.children).forEach(function(d){d.props.selected=s.value.indexOf(d.props.value)!=-1})),o=="select"&&s.defaultValue!=null&&(s.value=Z(n.children).forEach(function(d){d.props.selected=s.multiple?s.defaultValue.indexOf(d.props.value)!=-1:s.defaultValue==d.props.value})),n.class&&!n.className?(s.class=n.class,Object.defineProperty(s,"className",wo)):(n.className&&!n.class||n.class&&n.className)&&(s.class=s.className=n.className),t.props=s}(e),e.$$typeof=gn,Nt&&Nt(e)};var Ut=S.__r;S.__r=function(e){Ut&&Ut(e),pt=e.__c};var At=S.diffed;S.diffed=function(e){At&&At(e);var t=e.props,n=e.__e;n!=null&&e.type==="textarea"&&"value"in t&&t.value!==n.value&&(n.value=t.value==null?"":t.value),pt=null};var Cn={ReactCurrentDispatcher:{current:{readContext:function(e){return pt.__n[e.__c].props.value},useCallback:nt,useContext:ot,useDebugValue:st,useDeferredValue:at,useEffect:V,useId:rt,useImperativeHandle:tt,useInsertionEffect:dt,useLayoutEffect:ye,useMemo:ke,useReducer:Ie,useRef:ce,useState:D,useSyncExternalStore:it,useTransition:ut}}},So="18.3.1";function wn(e){return K.bind(null,e)}function je(e){return!!e&&e.$$typeof===gn}function Sn(e){return je(e)&&e.type===M}function kn(e){return!!e&&!!e.displayName&&(typeof e.displayName=="string"||e.displayName instanceof String)&&e.displayName.startsWith("Memo(")}function jn(e){return je(e)?Xn.apply(null,arguments):e}function En(e){return!!e.__k&&(fe(null,e),!0)}function Pn(e){return e&&(e.base||e.nodeType===1&&e)||null}var $n=function(e,t){return e(t)},Fn=function(e,t){return e(t)},Tn=M,Dn=je,In={useState:D,useId:rt,useReducer:Ie,useEffect:V,useLayoutEffect:ye,useInsertionEffect:dt,useTransition:ut,useDeferredValue:at,useSyncExternalStore:it,startTransition:ct,useRef:ce,useImperativeHandle:tt,useMemo:ke,useCallback:nt,useContext:ot,useDebugValue:st,version:"18.3.1",Children:_n,render:bn,hydrate:xn,unmountComponentAtNode:En,createPortal:yn,createElement:K,createContext:rn,createFactory:wn,cloneElement:jn,createRef:Xt,Fragment:M,isValidElement:je,isElement:Dn,isFragment:Sn,isMemo:kn,findDOMNode:Pn,Component:q,PureComponent:De,memo:dn,forwardRef:pn,flushSync:Fn,unstable_batchedUpdates:$n,StrictMode:Tn,Suspense:xe,SuspenseList:pe,lazy:vn,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Cn};const ko=Object.freeze(Object.defineProperty({__proto__:null,Children:_n,Component:q,Fragment:M,PureComponent:De,StrictMode:Tn,Suspense:xe,SuspenseList:pe,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Cn,cloneElement:jn,createContext:rn,createElement:K,createFactory:wn,createPortal:yn,createRef:Xt,default:In,findDOMNode:Pn,flushSync:Fn,forwardRef:pn,hydrate:xn,isElement:Dn,isFragment:Sn,isMemo:kn,isValidElement:je,lazy:vn,memo:dn,render:bn,startTransition:ct,unmountComponentAtNode:En,unstable_batchedUpdates:$n,useCallback:nt,useContext:ot,useDebugValue:st,useDeferredValue:at,useEffect:V,useErrorBoundary:Qn,useId:rt,useImperativeHandle:tt,useInsertionEffect:dt,useLayoutEffect:ye,useMemo:ke,useReducer:Ie,useRef:ce,useState:D,useSyncExternalStore:it,useTransition:ut,version:So},Symbol.toStringTag,{value:"Module"}));function jo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Eo(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function o(){return this instanceof o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(o){var s=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(n,o,s.get?s:{enumerable:!0,get:function(){return e[o]}})}),n}var Ln={exports:{}},On={};const Rn=Eo(ko);var Nn={exports:{}},Un={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var he=Rn;function Po(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var $o=typeof Object.is=="function"?Object.is:Po,Fo=he.useState,To=he.useEffect,Do=he.useLayoutEffect,Io=he.useDebugValue;function Lo(e,t){var n=t(),o=Fo({inst:{value:n,getSnapshot:t}}),s=o[0].inst,r=o[1];return Do(function(){s.value=n,s.getSnapshot=t,Be(s)&&r({inst:s})},[e,n,t]),To(function(){return Be(s)&&r({inst:s}),e(function(){Be(s)&&r({inst:s})})},[e]),Io(n),n}function Be(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!$o(e,n)}catch{return!0}}function Oo(e,t){return t()}var Ro=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Oo:Lo;Un.useSyncExternalStore=he.useSyncExternalStore!==void 0?he.useSyncExternalStore:Ro;Nn.exports=Un;var No=Nn.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Le=Rn,Uo=No;function Ao(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Mo=typeof Object.is=="function"?Object.is:Ao,Bo=Uo.useSyncExternalStore,Ho=Le.useRef,Vo=Le.useEffect,Jo=Le.useMemo,Wo=Le.useDebugValue;On.useSyncExternalStoreWithSelector=function(e,t,n,o,s){var r=Ho(null);if(r.current===null){var i={hasValue:!1,value:null};r.current=i}else i=r.current;r=Jo(function(){function p(_){if(!d){if(d=!0,f=_,_=o(_),s!==void 0&&i.hasValue){var b=i.value;if(s(b,_))return a=b}return a=_}if(b=a,Mo(f,_))return b;var j=o(_);return s!==void 0&&s(b,j)?(f=_,b):(f=_,a=j)}var d=!1,f,a,u=n===void 0?null:n;return[function(){return p(t())},u===null?void 0:function(){return p(u())}]},[t,n,o,s]);var c=Bo(e,r[0],r[1]);return Vo(function(){i.hasValue=!0,i.value=c},[c]),Wo(c),c};Ln.exports=On;var zo=Ln.exports;const qo=jo(zo),An={},{useDebugValue:Yo}=In,{useSyncExternalStoreWithSelector:Go}=qo;let Mt=!1;const Ko=e=>e;function Xo(e,t=Ko,n){(An?"production":void 0)!=="production"&&n&&!Mt&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Mt=!0);const o=Go(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Yo(o),o}const Bt=e=>{(An?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?ao(e):e,n=(o,s)=>Xo(t,o,s);return Object.assign(n,t),n},Mn=e=>e?Bt(e):Bt,Zo="aitrace-viewer",se="expand-collapse-state",Qo=2;async function _t(){return new Promise((e,t)=>{const n=indexedDB.open(Zo,Qo);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=o=>{const s=o.target.result;s.objectStoreNames.contains(se)||s.createObjectStore(se),s.objectStoreNames.contains("custom-lenses")||s.createObjectStore("custom-lenses")}})}async function es(){try{const e=await _t();return new Promise((t,n)=>{const r=e.transaction(se,"readonly").objectStore(se).get("expandedState");r.onsuccess=()=>{t(r.result||{})},r.onerror=()=>n(r.error)})}catch(e){return console.error("Failed to load state from IndexedDB:",e),{}}}async function ts(e){try{const t=await _t();return new Promise((n,o)=>{const i=t.transaction(se,"readwrite").objectStore(se).put(e,"expandedState");i.onsuccess=()=>n(),i.onerror=()=>o(i.error)})}catch(t){console.error("Failed to save state to IndexedDB:",t)}}const ft=Mn((e,t)=>({currentDocHash:null,expandedState:{},setDocumentHash:async n=>{const o=t();Object.keys(o.expandedState).length===0&&await t().loadFromIndexedDB(),e({currentDocHash:n})},isExpanded:n=>{var r;const{currentDocHash:o,expandedState:s}=t();return o?((r=s[o])==null?void 0:r[n])??!1:!1},setExpanded:(n,o)=>{const{currentDocHash:s,expandedState:r}=t();if(!s)return;const c={...r[s]||{},[n]:o},p={...r,[s]:c};e({expandedState:p}),t().saveToIndexedDB()},toggleExpanded:n=>{const{isExpanded:o,setExpanded:s}=t();s(n,!o(n))},clearCurrentDocState:()=>{const{currentDocHash:n,expandedState:o}=t();if(!n)return;const s={...o};delete s[n],e({expandedState:s}),t().saveToIndexedDB()},clearAllState:async()=>{e({expandedState:{},currentDocHash:null});try{const n=await _t();return new Promise((o,s)=>{const c=n.transaction(se,"readwrite").objectStore(se).clear();c.onsuccess=()=>o(),c.onerror=()=>s(c.error)})}catch(n){console.error("Failed to clear IndexedDB:",n)}},loadFromIndexedDB:async()=>{const n=await es();e({expandedState:n})},saveToIndexedDB:async()=>{const{expandedState:n}=t();await ts(n)}}));function oe({isOpen:e,jsonPath:t,value:n,eventName:o,initialData:s,onConfirm:r,onCancel:i}){const[c,p]=D(""),[d,f]=D(""),[a,u]=D(""),[_,b]=D(!1),j=ce(null),h=!!s;if(V(()=>{var P;if(console.log("CustomLensDialog: isOpen changed",e),e&&j.current){if(j.current.focus(),s)p(s.name),f(s.eventPattern),u(s.jsonPath);else if(t){const O=((P=t.split(/\.|\[/).pop())==null?void 0:P.replace(/\]/,""))||"custom-value";console.log("CustomLensDialog: Setting suggested name",O),p(O),f(o||".*"),u(t)}}},[e,t,o,s]),!e)return console.log("CustomLensDialog: Not rendering (isOpen=false)"),null;console.log("CustomLensDialog: Rendering dialog",{name:c,eventPattern:d,path:a});const C=P=>{P.preventDefault(),console.log("CustomLensDialog: Form submitted",{name:c.trim(),eventPattern:d.trim(),path:a}),c.trim()&&a.trim()?(console.log("CustomLensDialog: Calling onConfirm"),r({name:c.trim(),eventPattern:d.trim(),jsonPath:a.trim()})):console.log("CustomLensDialog: Name or path is empty, not calling onConfirm")},w=typeof n=="string"?`"${n}"`:JSON.stringify(n);return l("div",{class:"custom-lens-dialog-backdrop",onClick:i,children:l("div",{class:"custom-lens-dialog",onClick:P=>P.stopPropagation(),children:[l("div",{class:"custom-lens-dialog-header",children:[l("h5",{children:h?"Edit Custom Chip":"Create Custom Chip"}),l("button",{class:"btn-close",onClick:i})]}),l("form",{onSubmit:C,children:[l("div",{class:"custom-lens-dialog-body",children:[l("div",{class:"mb-3",children:[l("label",{class:"form-label small fw-bold",children:"JSON Path"}),l("input",{type:"text",class:"form-control form-control-sm",value:a,onInput:P=>u(P.target.value),disabled:!h,style:{fontFamily:"monospace",fontSize:"0.8rem"}})]}),!h&&n!==void 0&&l("div",{class:"mb-3",children:[l("label",{class:"form-label small fw-bold",children:"Current Value"}),l("input",{type:"text",class:"form-control form-control-sm",value:w,disabled:!0,style:{fontFamily:"monospace",fontSize:"0.8rem"}})]}),l("div",{class:"mb-3",children:[l("label",{class:"form-label small fw-bold",children:["Chip Name ",l("span",{class:"text-danger",children:"*"})]}),l("input",{ref:j,type:"text",class:"form-control form-control-sm",value:c,onInput:P=>p(P.target.value),placeholder:"e.g., temperature, max-tokens, my-value",required:!0}),l("small",{class:"text-muted",children:"This name will appear as a badge: [Chip Name: value]"})]}),l("div",{class:"mb-3",children:[l("label",{class:"form-label small fw-bold",children:"Event Pattern"}),l("div",{class:"input-group input-group-sm mb-2",children:[l("input",{type:"text",class:"form-control",value:d,onInput:P=>f(P.target.value),placeholder:"e.g., llm_end or llm_.*",style:{fontFamily:"monospace"}}),l("button",{type:"button",class:`btn btn-outline-secondary ${_?"active":""}`,onClick:()=>b(!_),title:"Toggle regex mode",children:".*"})]}),l("small",{class:"text-muted",children:_?"Regex pattern to match event names (e.g., llm_.* matches llm_start, llm_end)":"Exact event name to match (will be converted to case-insensitive match)"})]}),l("div",{class:"alert alert-info py-2 px-3",style:{fontSize:"0.8rem"},children:[l("i",{class:"bi bi-info-circle me-2"}),'This chip will appear inline for all events matching "',d,'"']})]}),l("div",{class:"custom-lens-dialog-footer",children:[l("button",{type:"button",class:"btn btn-sm btn-secondary",onClick:i,children:"Cancel"}),l("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:!c.trim()||!a.trim(),children:[l("i",{class:`bi ${h?"bi-check-circle":"bi-plus-circle"} me-1`}),h?"Save Changes":"Create Chip"]})]})]})]})})}const ns="aitrace-viewer",ve="custom-lenses",os=2;async function Bn(){return new Promise((e,t)=>{const n=indexedDB.open(ns,os);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=o=>{const s=o.target.result;s.objectStoreNames.contains("expand-collapse-state")||s.createObjectStore("expand-collapse-state"),s.objectStoreNames.contains(ve)||s.createObjectStore(ve)}})}async function ss(){try{const e=await Bn();return new Promise((t,n)=>{const r=e.transaction(ve,"readonly").objectStore(ve).get("customFields");r.onsuccess=()=>{t(r.result||[])},r.onerror=()=>n(r.error)})}catch(e){return console.error("Failed to load custom fields from IndexedDB:",e),[]}}async function rs(e){try{const t=await Bn();return new Promise((n,o)=>{const i=t.transaction(ve,"readwrite").objectStore(ve).put(e,"customFields");i.onsuccess=()=>n(),i.onerror=()=>o(i.error)})}catch(t){console.error("Failed to save custom fields to IndexedDB:",t)}}function ls(e,t){try{console.log("extractValueByPath: Starting extraction"),console.log("extractValueByPath: Object keys at root:",Object.keys(e||{})),console.log("extractValueByPath: Path:",t);const n=t.split(/\.|\[|\]/).filter(s=>s!=="");console.log("extractValueByPath: Path parts:",n);let o=e;for(let s=0;s<n.length;s++){const r=n[s];if(console.log(`extractValueByPath: Step ${s}: accessing "${r}" in:`,typeof o,Array.isArray(o)?`Array(${o.length})`:""),o==null){console.log(`extractValueByPath: Current is null/undefined at step ${s}, returning undefined`);return}typeof o=="object"&&console.log("extractValueByPath: Available keys:",Object.keys(o)),o=o[r],console.log(`extractValueByPath: After accessing "${r}":`,typeof o,o===void 0?"UNDEFINED!":"")}return console.log("extractValueByPath: Final value:",o),o}catch(n){console.error("Failed to extract value by path:",t,n);return}}const mt=Mn((e,t)=>({customFields:[],addCustomField:n=>{console.log("customLensStore.addCustomField called with:",n);const o={...n,id:`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:Date.now()};console.log("Created new custom field:",o);const s=[...t().customFields,o];e({customFields:s}),console.log("Updated customFields:",s),t().saveToIndexedDB()},updateCustomField:(n,o)=>{const s=t().customFields.map(r=>r.id===n?{...r,...o}:r);e({customFields:s}),t().saveToIndexedDB()},deleteCustomField:n=>{const o=t().customFields.filter(s=>s.id!==n);e({customFields:o}),t().saveToIndexedDB()},getFieldsForEvent:n=>{const o=t().customFields;console.log("customLensStore.getFieldsForEvent: Looking for event",n,"in",o.length,"custom fields");const s=o.filter(r=>{try{const c=new RegExp(r.eventPattern,"i").test(n);return console.log(`customLensStore.getFieldsForEvent: Pattern "${r.eventPattern}" ${c?"MATCHES":"does not match"} event "${n}"`),c}catch{const i=r.eventPattern.toLowerCase()===n.toLowerCase();return console.log(`customLensStore.getFieldsForEvent: Exact match "${r.eventPattern}" ${i?"MATCHES":"does not match"} event "${n}"`),i}});return console.log("customLensStore.getFieldsForEvent: Returning",s.length,"matching fields"),s},exportCustomFields:()=>{const{customFields:n}=t();return JSON.stringify(n,null,2)},importCustomFields:n=>{try{const o=JSON.parse(n);Array.isArray(o)&&(e({customFields:o}),t().saveToIndexedDB())}catch(o){throw console.error("Failed to import custom fields:",o),new Error("Invalid JSON format")}},loadFromIndexedDB:async()=>{const n=await ss();e({customFields:n})},saveToIndexedDB:async()=>{const{customFields:n}=t();await rs(n)}}));function te({isOpen:e,x:t,y:n,jsonText:o,isPrimitive:s=!1,onCopyJson:r,onDownloadJson:i,onUseAsChip:c,onClose:p}){const d=ce(null);return V(()=>{console.log("JsonContextMenu render state:",{isOpen:e,isPrimitive:s,hasUseAsChip:!!c})},[e,s,c]),V(()=>{const f=a=>{d.current&&!d.current.contains(a.target)&&p()};if(e)return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[e,p]),e?(console.log("JsonContextMenu: rendering menu at",{x:t,y:n}),l("div",{ref:d,class:"json-context-menu",style:{top:n+"px",left:t+"px"},children:[l("button",{class:"menu-item",onClick:r,children:[l("i",{class:"bi bi-clipboard me-2"}),"Copy Value"]}),l("button",{class:"menu-item",onClick:i,children:[l("i",{class:"bi bi-download me-2"}),"Download JSON"]}),s&&c&&l(M,{children:[l("div",{class:"menu-divider"}),l("button",{class:"menu-item menu-item-primary",onClick:c,children:[l("i",{class:"bi bi-star me-2"}),"Use as Chip"]})]})]})):(console.log("JsonContextMenu: not rendering (isOpen=false)"),null)}function Ht(e){if(typeof e!="string")return e;const t=e.trim();if(t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]"))try{return JSON.parse(e)}catch{return e}return e}function ne(e){try{if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e)}catch{}const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-10000px",t.style.top="-10000px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch{}return document.body.removeChild(t),Promise.resolve()}function Ke({value:e,name:t,jsonKey:n,depth:o=0,maxInitialDepth:s=0,pathPrefix:r="",eventName:i="",jsonPath:c=""}){const{isExpanded:p,toggleExpanded:d}=ft(),{addCustomField:f}=mt(),a=ce(null),[u,_]=D({open:!1,x:0,y:0,jsonText:""}),[b,j]=D(!1),[h,C]=D(null),w=r+(t?`:${t}`:`:${o}`),P=n||t,O=P?c?`${c}.${P}`:P:c,R=p(w);V(()=>{const m=y=>{a.current&&!a.current.contains(y.target)&&_(x=>({...x,open:!1}))};return window.addEventListener("click",m),window.addEventListener("scroll",m,!0),()=>{window.removeEventListener("click",m),window.removeEventListener("scroll",m,!0)}},[]),V(()=>{console.log("ctx state changed:",u)},[u]);const U=(m,y=!1,x)=>{m.preventDefault(),m.stopPropagation(),console.log("onContextMenu called!",{isPrimitive:y,currentJsonPath:O,eventName:i,hasValue:x!==void 0});const $=(()=>{try{const g=x!==void 0?x:Ht(e);return JSON.stringify(g,null,2)}catch{return String(x!==void 0?x:e)}})(),v=m,E=v.clientX||0,I=v.clientY||0;console.log("Setting ctx state:",{open:!0,x:E,y:I,isPrimitive:y,jsonPath:O}),_({open:!0,x:E,y:I,jsonText:$,isPrimitive:y,value:x!==void 0?x:e,jsonPath:O})},A=()=>{u.jsonPath&&u.value!==void 0&&(C({path:u.jsonPath,value:u.value}),j(!0),_(m=>({...m,open:!1})))},N=m=>{console.log("handleCustomLensConfirm called",{data:m,dialogData:h}),console.log("Creating custom field:",m),f({name:m.name,eventPattern:m.eventPattern,jsonPath:m.jsonPath}),console.log("Custom field created successfully!"),j(!1),C(null)},k=Ht(e);if(k===null)return l(M,{children:[l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-null json-value-clickable",onContextMenu:m=>U(m,!0,k),title:"Right-click for options",children:"null"})]}),l(te,{isOpen:u.open,x:u.x,y:u.y,jsonText:u.jsonText,isPrimitive:u.isPrimitive,onCopyJson:()=>{ne(u.jsonText),_(m=>({...m,open:!1}))},onDownloadJson:()=>{const m=new Blob([u.jsonText],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(m),y.download="data.json",y.click(),_(x=>({...x,open:!1}))},onUseAsChip:u.isPrimitive?A:void 0,onClose:()=>_(m=>({...m,open:!1}))}),l(oe,{isOpen:b,jsonPath:(h==null?void 0:h.path)||"",value:h==null?void 0:h.value,eventName:i,onConfirm:N,onCancel:()=>{j(!1),C(null)}})]});if(k===void 0)return l(M,{children:[l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-undefined json-value-clickable",onContextMenu:m=>U(m,!0,k),title:"Right-click for options",children:"undefined"})]}),l(te,{isOpen:u.open,x:u.x,y:u.y,jsonText:u.jsonText,isPrimitive:u.isPrimitive,onCopyJson:()=>{ne(u.jsonText),_(m=>({...m,open:!1}))},onDownloadJson:()=>{const m=new Blob([u.jsonText],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(m),y.download="data.json",y.click(),_(x=>({...x,open:!1}))},onUseAsChip:u.isPrimitive?A:void 0,onClose:()=>_(m=>({...m,open:!1}))}),l(oe,{isOpen:b,jsonPath:(h==null?void 0:h.path)||"",value:h==null?void 0:h.value,eventName:i,onConfirm:N,onCancel:()=>{j(!1),C(null)}})]});if(typeof k=="boolean")return l(M,{children:[l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-boolean json-value-clickable",onContextMenu:m=>U(m,!0,k),title:"Right-click for options",children:k?"true":"false"})]}),l(te,{isOpen:u.open,x:u.x,y:u.y,jsonText:u.jsonText,isPrimitive:u.isPrimitive,onCopyJson:()=>{ne(u.jsonText),_(m=>({...m,open:!1}))},onDownloadJson:()=>{const m=new Blob([u.jsonText],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(m),y.download="data.json",y.click(),_(x=>({...x,open:!1}))},onUseAsChip:u.isPrimitive?A:void 0,onClose:()=>_(m=>({...m,open:!1}))}),l(oe,{isOpen:b,jsonPath:(h==null?void 0:h.path)||"",value:h==null?void 0:h.value,eventName:i,onConfirm:N,onCancel:()=>{j(!1),C(null)}})]});if(typeof k=="number")return l(M,{children:[l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-number json-value-clickable",onContextMenu:m=>U(m,!0,k),title:"Right-click for options",children:k})]}),l(te,{isOpen:u.open,x:u.x,y:u.y,jsonText:u.jsonText,isPrimitive:u.isPrimitive,onCopyJson:()=>{ne(u.jsonText),_(m=>({...m,open:!1}))},onDownloadJson:()=>{const m=new Blob([u.jsonText],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(m),y.download="data.json",y.click(),_(x=>({...x,open:!1}))},onUseAsChip:u.isPrimitive?A:void 0,onClose:()=>_(m=>({...m,open:!1}))}),l(oe,{isOpen:b,jsonPath:(h==null?void 0:h.path)||"",value:h==null?void 0:h.value,eventName:i,onConfirm:N,onCancel:()=>{j(!1),C(null)}})]});if(typeof k=="string"){if(k.length>100){const m=w+":longstring",y=p(m);return l(M,{children:[l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-string json-value-clickable",onContextMenu:x=>U(x,!0,k),title:"Right-click for options",children:['"',y?k:k.substring(0,100),!y&&"...",'"',l("button",{class:"json-expand-text",onClick:()=>d(m),children:y?"less":"more"})]})]}),l(te,{isOpen:u.open,x:u.x,y:u.y,jsonText:u.jsonText,isPrimitive:u.isPrimitive,onCopyJson:()=>{ne(u.jsonText),_(x=>({...x,open:!1}))},onDownloadJson:()=>{const x=new Blob([u.jsonText],{type:"application/json"}),$=document.createElement("a");$.href=URL.createObjectURL(x),$.download="data.json",$.click(),_(v=>({...v,open:!1}))},onUseAsChip:u.isPrimitive?A:void 0,onClose:()=>_(x=>({...x,open:!1}))}),l(oe,{isOpen:b,jsonPath:(h==null?void 0:h.path)||"",value:h==null?void 0:h.value,eventName:i,onConfirm:N,onCancel:()=>{j(!1),C(null)}})]})}return l(M,{children:[l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-string json-value-clickable",onContextMenu:m=>U(m,!0,k),title:"Right-click for options",children:['"',k,'"']})]}),l(te,{isOpen:u.open,x:u.x,y:u.y,jsonText:u.jsonText,isPrimitive:u.isPrimitive,onCopyJson:()=>{ne(u.jsonText),_(m=>({...m,open:!1}))},onDownloadJson:()=>{const m=new Blob([u.jsonText],{type:"application/json"}),y=document.createElement("a");y.href=URL.createObjectURL(m),y.download="data.json",y.click(),_(x=>({...x,open:!1}))},onUseAsChip:u.isPrimitive?A:void 0,onClose:()=>_(m=>({...m,open:!1}))}),l(oe,{isOpen:b,jsonPath:(h==null?void 0:h.path)||"",value:h==null?void 0:h.value,eventName:i,onConfirm:N,onCancel:()=>{j(!1),C(null)}})]})}if(Array.isArray(k)){if(k.length===0)return l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-bracket",children:"[]"})]});const y=k.every($=>typeof $!="object"||$===null)&&k.length<=5?k.map($=>$===null?"null":typeof $=="string"?`"${$}"`:String($)).join(", "):null,x=y&&y.length<60;return l("div",{class:"json-array-container",onContextMenu:U,children:[l("div",{class:"json-toggle-line",children:[l("span",{class:"json-toggle-icon",onClick:()=>d(w),children:l("i",{class:`bi bi-chevron-${R?"down":"right"}`})}),l("span",{class:"json-inline-content",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-bracket",children:"["}),!R&&x&&l("span",{class:"json-inline-items",children:y}),!R&&!x&&l("span",{class:"json-preview",children:[k.length," items"]}),!R&&l("span",{class:"json-bracket",children:"]"})]})]}),R&&l("div",{class:"json-array-items",children:[k.map(($,v)=>l("div",{class:"json-item",children:l(Ke,{value:$,depth:o+1,maxInitialDepth:s,pathPrefix:w+`:[${v}]`,eventName:i,jsonPath:O+`[${v}]`})},v)),l("span",{class:"json-bracket",children:"]"})]}),l(te,{isOpen:u.open,x:u.x,y:u.y,jsonText:u.jsonText,isPrimitive:u.isPrimitive,onCopyJson:()=>{ne(u.jsonText),_($=>({...$,open:!1}))},onDownloadJson:()=>{const $=new Blob([u.jsonText],{type:"application/json"}),v=document.createElement("a");v.href=URL.createObjectURL($),v.download="data.json",v.click(),_(E=>({...E,open:!1}))},onUseAsChip:u.isPrimitive?A:void 0,onClose:()=>_($=>({...$,open:!1}))}),l(oe,{isOpen:b,jsonPath:(h==null?void 0:h.path)||"",value:h==null?void 0:h.value,eventName:i,onConfirm:N,onCancel:()=>{j(!1),C(null)}})]})}if(typeof k=="object"){const m=Object.entries(k);if(m.length===0)return l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-bracket",children:"{}"})]});const x=m.every(([v,E])=>typeof E!="object"||E===null)&&m.length<=3?m.map(([v,E])=>{const I=E===null?"null":typeof E=="string"?`"${E}"`:String(E);return`${v}: ${I}`}).join(", "):null,$=x&&x.length<60;return l("div",{class:"json-object-container",onContextMenu:U,children:[l("div",{class:"json-toggle-line",children:[l("span",{class:"json-toggle-icon",onClick:()=>d(w),children:l("i",{class:`bi bi-chevron-${R?"down":"right"}`})}),l("span",{class:"json-inline-content",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-bracket",children:"{"}),!R&&$&&l("span",{class:"json-inline-items",children:x}),!R&&!$&&l("span",{class:"json-preview",children:[m.length," props"]}),!R&&l("span",{class:"json-bracket",children:"}"})]})]}),R&&l("div",{class:"json-object-items",children:[m.map(([v,E])=>l("div",{class:"json-property",children:l(Ke,{name:v,jsonKey:v,value:E,depth:o+1,maxInitialDepth:s,pathPrefix:w,eventName:i,jsonPath:O})},v)),l("span",{class:"json-bracket",children:"}"})]}),l(te,{isOpen:u.open,x:u.x,y:u.y,jsonText:u.jsonText,isPrimitive:u.isPrimitive,onCopyJson:()=>{ne(u.jsonText),_(v=>({...v,open:!1}))},onDownloadJson:()=>{const v=new Blob([u.jsonText],{type:"application/json"}),E=document.createElement("a");E.href=URL.createObjectURL(v),E.download="data.json",E.click(),_(I=>({...I,open:!1}))},onUseAsChip:u.isPrimitive?A:void 0,onClose:()=>_(v=>({...v,open:!1}))})]})}return l("span",{class:"json-inline",children:[t&&l("span",{class:"json-key",children:[t,": "]}),l("span",{class:"json-unknown",children:String(k)})]})}function is({data:e,name:t,jsonKey:n,depth:o=0,maxInitialDepth:s=0,pathPrefix:r="",eventName:i="",jsonPath:c=""}){return l("div",{class:"json-tree",children:l(Ke,{value:e,name:t,jsonKey:n,depth:o,maxInitialDepth:s,pathPrefix:r,eventName:i,jsonPath:c})})}const Hn={eventPattern:/.*/,fields:[{key:"*",type:"json-tree",maxInitialDepth:1}],priority:0},cs={eventPattern:/llm_start/i,fields:[{key:"prompts",display:"Prompts",type:"json-tree",maxInitialDepth:2},{key:"model",display:"Model",type:"text"},{key:"run_id",display:"Run ID",type:"text"}],priority:10},as={eventPattern:/llm_end/i,fields:[{key:"response",display:"Response",type:"json-tree",maxInitialDepth:2},{key:"run_id",display:"Run ID",type:"text"}],priority:10},us={eventPattern:/chatbot_(invoked|response_generated|error)/i,fields:[{key:"message_count",display:"Message Count",type:"text"},{key:"response_length",display:"Response Length",type:"text"},{key:"error",display:"Error",type:"json-tree",maxInitialDepth:2}],priority:10},ds=[cs,as,us,Hn];function ps(e){const t=[...ds].sort((n,o)=>(o.priority||0)-(n.priority||0));for(const n of t)if(typeof n.eventPattern=="string"){if(n.eventPattern===e)return n}else if(n.eventPattern instanceof RegExp&&n.eventPattern.test(e))return n;return Hn}function Vt(e){if(e==null)return!0;const t=typeof e;return t==="string"||t==="number"||t==="boolean"?!(t==="string"&&e.length>80):!(Array.isArray(e)||t==="object")}function He(e){const t=ps(e.event||""),n=[],o=new Set(["timestamp","event","trace_id","span_id","parent_span_id","level"]);if(t.fields.some(r=>r.key==="*")){const r=t.fields.find(i=>i.key==="*");Object.entries(e).forEach(([i,c])=>{if(!o.has(i)){const p=Vt(c)?"text":r.type||"json-tree";n.push({key:i,display:i.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase()),value:c,type:p,maxInitialDepth:r.maxInitialDepth})}})}else t.fields.forEach(r=>{if(e[r.key]!==void 0){const i=r.type||(Vt(e[r.key])?"text":"json-tree");n.push({key:r.key,display:r.display||r.key.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()),value:e[r.key],type:i,maxInitialDepth:r.maxInitialDepth})}});return n}function Vn({node:e,trace:t,timestampSettings:n,densitySettings:o,traceStartTime:s}){const{isExpanded:r,toggleExpanded:i}=ft(),{getFieldsForEvent:c,deleteCustomField:p,updateCustomField:d}=mt(),[f,a]=D({open:!1,x:0,y:0}),[u,_]=D(!1),[b,j]=D(null);V(()=>{if(!f.open)return;const g=()=>a({open:!1,x:0,y:0});return document.addEventListener("click",g),()=>document.removeEventListener("click",g)},[f.open]);const h=g=>{const B=g.event||"";console.log("NodeRow.applyCustomLenses: Processing event",B),console.log("NodeRow.applyCustomLenses: Log entry structure:",g);const J=c(B);console.log("NodeRow.applyCustomLenses: Found custom fields",J);const W=J.map(H=>{console.log(`NodeRow.applyCustomLenses: Trying to extract from path "${H.jsonPath}"`);const Y=ls(g,H.jsonPath);return console.log(`NodeRow.applyCustomLenses: Extracted "${H.name}" from "${H.jsonPath}":`,Y),Y!==void 0?{key:`custom-${H.id}`,display:H.name,value:Y,type:"text",isCustom:!0}:null}).filter(Boolean);return console.log("NodeRow.applyCustomLenses: Returning",W.length,"custom fields"),W},C=`span:${e.id}`,w=r(C),P=lo(o.mode),O=io(o.mode),R={info:"badge-info",debug:"badge-debug",warn:"badge-warn",error:"badge-error"}[e.level]||"badge-info",U=e.children.length>0,A=e.raw&&e.raw.length>0,N=e.raw&&e.raw.length>1,k=A&&e.raw.some(g=>He(g).length>0),m=U||N||k,y=m?w?"bi-chevron-down":"bi-chevron-right":"bi-dot",x=A&&e.raw.length>=1?He(e.raw[0]):[],$=A&&e.raw.length>=1?h(e.raw[0]):[],v=[...x,...$],E=v.filter(g=>g.type==="text");v.some(g=>g.type==="json-tree");const I=!w&&E.length>0;return l("div",{style:{marginLeft:e.depth*16+"px"},children:[l("div",{class:"node-row",style:{padding:`${P.vertical} ${P.horizontal}`,margin:O},children:l("div",{class:"node-content",children:[l("i",{class:`bi ${y} node-icon`,onClick:()=>m&&i(C),style:{cursor:m?"pointer":"default"},title:m?"Click to expand/collapse":""}),l("span",{class:"node-message",children:e.msg||"(no event)"}),I&&E.map((g,B)=>{const J=`chipfold:${C}:inline:${g.key}`,W=!r(J),H=g.isCustom,Y=H?g.key.replace("custom-",""):void 0,re=e.raw[0];return l("span",{class:`field-chip badge ${H?"custom-chip":"bg-light text-dark border"} ms-1 ${W?"chip-folded":"chip-unfolded"}`,style:{fontWeight:"normal"},onClick:X=>{X.stopPropagation(),i(J)},onContextMenu:X=>{if(H&&Y){X.preventDefault(),X.stopPropagation();const Ee=c((re==null?void 0:re.event)||"").find(Re=>Re.id===Y);a({open:!0,x:X.clientX,y:X.clientY,customFieldId:Y,customField:Ee})}},children:[l("span",{class:"field-chip-label",style:{fontWeight:600,color:"#6c757d"},children:[g.display,":"]})," ",l("span",{class:"field-chip-value",style:{fontFamily:"Courier New, monospace"},children:String(g.value)})]},g.key)}),l("span",{class:`badge ${R} node-badge ms-1`,children:e.level}),N&&l("span",{class:"badge badge-secondary ms-1",children:[e.raw.length," logs"]})]})}),w&&A&&l("div",{class:"node-details",style:{marginLeft:o.mode==="compact"?"16px":"24px",marginTop:o.mode==="compact"?"2px":"4px",marginBottom:o.mode==="compact"?"2px":"8px",padding:o.mode==="compact"?"2px 4px":"4px 8px"},children:e.raw.map((g,B)=>{const J=He(g),W=h(g),H=[...J,...W],Y=`log:${e.id}:${B}`,re=`logexpand:${e.id}:${B}`,X=r(Y),Oe=r(re),Ee=H.filter(F=>F.type==="text"),Re=H.filter(F=>F.type==="json-tree");return l("div",{class:"log-entry",children:[!Oe&&l("div",{class:"log-entry-compact",style:{padding:`${P.vertical} 0`,margin:O},children:[N&&l("i",{class:"bi bi-chevron-right",onClick:()=>i(re),style:{fontSize:"0.75rem",marginRight:"4px",cursor:"pointer"},title:"Click to expand log entry"}),N&&l("span",{class:"log-event",style:{fontWeight:500,marginRight:"8px"},children:g.event}),Ee.map(F=>{const ae=`chipfold:${e.id}:${B}:compact:${F.key}`,Pe=!r(ae),ue=F.isCustom,de=ue?F.key.replace("custom-",""):void 0;return l("span",{class:`field-chip badge ${ue?"custom-chip":"bg-light text-dark border"} ms-1 ${Pe?"chip-folded":"chip-unfolded"}`,style:{fontWeight:"normal",fontSize:"0.7rem"},onClick:z=>{z.stopPropagation(),i(ae)},onContextMenu:z=>{if(ue&&de){z.preventDefault(),z.stopPropagation();const Ne=c(g.event||"").find(ge=>ge.id===de);a({open:!0,x:z.clientX,y:z.clientY,customFieldId:de,customField:Ne})}},children:[l("span",{class:"field-chip-label",style:{fontWeight:600,color:"#6c757d"},children:[F.display,":"]})," ",l("span",{class:"field-chip-value",style:{fontFamily:"Courier New, monospace"},children:String(F.value)})]},F.key)})]}),Oe&&l(M,{children:[l("div",{class:"log-entry-header",children:[l("i",{class:"bi bi-chevron-down",onClick:()=>i(re),style:{fontSize:"0.75rem",marginRight:"4px",cursor:"pointer"},title:"Click to collapse log entry"}),n.showInNodes&&l("span",{class:"log-timestamp text-muted",children:Ye(g.timestamp,n,s)}),N&&l("span",{class:"log-event fw-bold ms-2",children:g.event}),l("button",{class:"btn btn-xxs btn-light text-muted border-0 ms-2 raw-toggle",onClick:F=>{F.stopPropagation(),i(Y)},type:"button",children:X?"hide raw":"raw"})]}),X&&l("pre",{class:"raw-json border rounded p-2 bg-light",children:JSON.stringify(g,null,2)}),H.length>0&&l("div",{class:"log-extra-fields mt-2",children:[l("div",{class:"field-chips d-flex flex-wrap gap-1 mb-2",children:Ee.map(F=>{const ae=String(F.value||""),Pe=ae.length>50,ue=`chip:${e.id}:${B}:${F.key}`,de=`chipfold:${e.id}:${B}:${F.key}`,z=r(ue),ht=!r(de),Ne=Pe&&!z?ae.substring(0,50)+"...":ae,ge=F.isCustom,Ue=ge?F.key.replace("custom-",""):void 0;return l("span",{class:`field-chip badge ${ge?"custom-chip":"bg-light text-dark border"} ${z?"chip-expanded":""} ${ht?"chip-folded":"chip-unfolded"}`,onClick:ee=>{ee.stopPropagation(),i(de)},onContextMenu:ee=>{if(ge&&Ue){ee.preventDefault(),ee.stopPropagation();const Jn=c(g.event||"").find(Wn=>Wn.id===Ue);a({open:!0,x:ee.clientX,y:ee.clientY,customFieldId:Ue,customField:Jn})}},children:[l("span",{class:"field-chip-label",children:[F.display,":"]}),l("span",{class:"field-chip-value",children:Ne}),Pe&&l("button",{class:"chip-toggle-btn ml-1",onClick:ee=>{ee.stopPropagation(),i(ue)},title:z?"Show less":"Show more",children:z?"−":"+"})]},F.key)})}),Re.map(F=>l("div",{class:"field-container mb-2",children:l(is,{data:F.value,name:F.display,jsonKey:F.key,maxInitialDepth:F.maxInitialDepth||0,pathPrefix:`json:${e.id}:${B}:${F.key}`,eventName:g.event,jsonPath:""})},F.key))]})]})]},B)})}),w&&U&&e.children.map(g=>l(Vn,{node:t.nodes.get(g),trace:t,timestampSettings:n,densitySettings:o,traceStartTime:s},g)),f.open&&l("div",{class:"chip-context-menu",style:{left:`${f.x}px`,top:`${f.y}px`},onClick:g=>g.stopPropagation(),children:[l("div",{class:"chip-context-menu-item",onClick:()=>{f.customField&&(j(f.customField),_(!0),a({open:!1,x:0,y:0}))},children:[l("i",{class:"bi bi-pencil"}),l("span",{children:"Edit Lens"})]}),l("div",{class:"chip-context-menu-item danger",onClick:()=>{f.customFieldId&&(confirm("Delete this custom chip lens?")&&p(f.customFieldId),a({open:!1,x:0,y:0}))},children:[l("i",{class:"bi bi-trash"}),l("span",{children:"Delete Lens"})]})]}),u&&b&&l(oe,{isOpen:u,initialData:{name:b.name,eventPattern:b.eventPattern,jsonPath:b.jsonPath},onConfirm:g=>{d(b.id,{name:g.name,eventPattern:g.eventPattern,jsonPath:g.jsonPath}),_(!1),j(null)},onCancel:()=>{_(!1),j(null)}})]})}function _s(e){if(e<1e3)return`${e}ms`;if(e<6e4)return`${(e/1e3).toFixed(2)}s`;const t=Math.floor(e/6e4),n=(e%6e4/1e3).toFixed(0);return`${t}m ${n}s`}function fs({forest:e,timestampSettings:t,densitySettings:n}){const o=Array.from(e.values());return l("div",{class:"traces-container",children:o.map((s,r)=>l("div",{class:"trace-section",children:[l("div",{class:"trace-header-card compact",children:[l("div",{class:"trace-header-line",children:[l("i",{class:"bi bi-diagram-3 me-2"}),l("span",{class:"trace-name small",children:s.name||"Unknown Trace"})]}),l("div",{class:"trace-metadata",children:[l("div",{class:"trace-meta-item",children:[l("i",{class:"bi bi-fingerprint me-1"}),l("span",{class:"text-muted small",children:"ID:"}),l("code",{class:"trace-id-code",children:s.roots.join(", ")||"unknown"})]}),s.startTime&&t.mode!=="hidden"&&t.mode!=="relative"&&l("div",{class:"trace-meta-item",children:[l("i",{class:"bi bi-clock me-1"}),l("span",{class:"text-muted small",children:"Start:"}),l("span",{class:"trace-time",children:Ye(s.startTime,t)})]}),s.endTime&&s.startTime!==s.endTime&&t.mode!=="hidden"&&t.mode!=="relative"&&l("div",{class:"trace-meta-item",children:[l("i",{class:"bi bi-clock-history me-1"}),l("span",{class:"text-muted small",children:"End:"}),l("span",{class:"trace-time",children:Ye(s.endTime,t)})]}),s.durationMs!==void 0&&s.durationMs>0&&l("div",{class:"trace-meta-item",children:[l("i",{class:"bi bi-hourglass-split me-1"}),l("span",{class:"text-muted small",children:"Duration:"}),l("span",{class:"trace-duration badge bg-secondary",children:_s(s.durationMs)})]})]})]}),l("div",{class:"trace-tree",children:s.roots.map(i=>{const c=s.nodes.get(i);return l(Vn,{node:c,trace:s,timestampSettings:t,densitySettings:n,traceStartTime:s.startTime},i)})})]},r))})}function ms({settings:e,onSettingsChange:t}){const[n,o]=D(!1);function s(p){const d=p.target;t({...e,mode:d.value})}function r(p){const d=p.target;t({...e,decimalPlaces:parseInt(d.value,10)})}function i(){t({...e,forceEnUS:!e.forceEnUS})}function c(){t({...e,showInNodes:!e.showInNodes})}return l("div",{class:"timestamp-settings-container",children:[l("button",{class:"btn btn-outline-secondary btn-sm",onClick:()=>o(!n),type:"button",children:[l("i",{class:"bi bi-clock-history me-1"}),"Timestamp Format",l("i",{class:`bi bi-chevron-${n?"up":"down"} ms-1`})]}),n&&l("div",{class:"timestamp-settings-panel",children:[l("div",{class:"setting-group",children:[l("label",{class:"setting-label",children:[l("i",{class:"bi bi-layout-text-window me-1"}),"Display Mode:"]}),l("select",{class:"form-select form-select-sm",value:e.mode,onChange:s,children:[l("option",{value:"full",children:"Full Date & Time"}),l("option",{value:"time",children:"Time Only"}),l("option",{value:"relative",children:"Relative to Start"}),l("option",{value:"hidden",children:"Hidden"})]}),l("small",{class:"text-muted setting-hint",children:[e.mode==="full"&&"Oct 24, 10:31:44.917 AM",e.mode==="time"&&"10:31:44.917 AM",e.mode==="relative"&&"+1.857s",e.mode==="hidden"&&"Timestamps hidden"]})]}),e.mode==="relative"&&l("div",{class:"setting-group",children:[l("label",{class:"setting-label",children:[l("i",{class:"bi bi-dash-circle me-1"}),"Decimal Places:"]}),l("input",{type:"number",class:"form-control form-control-sm",value:e.decimalPlaces,min:"0",max:"6",onChange:r}),l("small",{class:"text-muted setting-hint",children:["Example: +",1.857123.toFixed(e.decimalPlaces),"s"]})]}),(e.mode==="time"||e.mode==="full")&&l("div",{class:"setting-group",children:[l("label",{class:"setting-checkbox",children:[l("input",{type:"checkbox",class:"form-check-input me-2",checked:e.forceEnUS,onChange:i}),l("span",{children:"Force en-US locale"})]}),l("small",{class:"text-muted setting-hint",children:e.forceEnUS?"Using US format (AM/PM, MM/DD)":"Using browser locale"})]}),l("div",{class:"setting-group",children:l("label",{class:"setting-checkbox",children:[l("input",{type:"checkbox",class:"form-check-input me-2",checked:e.showInNodes,onChange:c}),l("span",{children:"Show timestamps in log entries"})]})})]})]})}function hs({settings:e,onSettingsChange:t}){const[n,o]=D(!1),s=ce(null);V(()=>{function p(d){s.current&&!s.current.contains(d.target)&&o(!1)}if(n)return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[n]);const r=p=>{t({...e,mode:p}),o(!1)},i={compact:"Compact",cozy:"Cozy",comfortable:"Comfortable"},c={compact:"bi-layout-text-window",cozy:"bi-layout-text-window-reverse",comfortable:"bi-layout-split"};return l("div",{class:"density-settings-container",ref:s,children:[l("button",{class:"btn btn-outline-secondary btn-sm",onClick:()=>o(!n),title:"Adjust spacing/density",children:[l("i",{class:`bi ${c[e.mode]} me-1`}),i[e.mode]]}),n&&l("div",{class:"density-settings-panel",children:[l("h6",{class:"mb-3",children:"Spacing Density"}),l("div",{class:"setting-group",children:[l("label",{class:"setting-label",children:"View Density"}),l("div",{class:"btn-group-vertical w-100",role:"group",children:["compact","cozy","comfortable"].map(p=>l("button",{type:"button",class:`btn btn-sm ${e.mode===p?"btn-primary":"btn-outline-secondary"}`,onClick:()=>r(p),children:[l("i",{class:`bi ${c[p]} me-2`}),i[p],p==="compact"&&l("small",{class:"d-block text-muted",style:{fontSize:"0.7rem"},children:"Zero padding"}),p==="cozy"&&l("small",{class:"d-block text-muted",style:{fontSize:"0.7rem"},children:"Minimal spacing"}),p==="comfortable"&&l("small",{class:"d-block text-muted",style:{fontSize:"0.7rem"},children:"Default spacing"})]},p))})]}),l("div",{class:"mt-3 p-2 bg-light rounded",children:l("small",{class:"text-muted",children:[l("i",{class:"bi bi-info-circle me-1"}),"Adjust the vertical spacing between nodes for your preference."]})})]})]})}async function Jt(e){const n=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(o)).map(i=>i.toString(16).padStart(2,"0")).join("")}function vs(){var x,$;const[e,t]=D(null),[n,o]=D(!1),[s,r]=D([]),[i,c]=D(""),[p,d]=D(!1),[f,a]=D(no()),[u,_]=D(so()),[b,j]=D(""),{setDocumentHash:h,clearCurrentDocState:C,clearAllState:w,loadFromIndexedDB:P}=ft(),{loadFromIndexedDB:O}=mt();V(()=>{P(),O(),fetch("./samples/config.json").then(v=>v.json()).then(v=>{r(v.samples),v.samples.length>0&&c(v.samples[0].id)}).catch(v=>console.error("Failed to load samples config:",v))},[]);async function R(v){const E=s.find(I=>I.id===v);if(E){d(!0);try{const g=await(await fetch(`./samples/${E.filename}`)).text(),B=g.trim().split(`
`).map(W=>JSON.parse(W)),J=await Jt(g);await h(J),j(E.filename),t(Pt(B))}catch(I){console.error("Failed to load sample:",I),alert("Failed to load sample file")}finally{d(!1)}}}function U(v){const I=v.target.value;c(I),R(I)}function A(v){const E=new FileReader;E.onload=async I=>{var W;const g=(W=I.target)==null?void 0:W.result,B=g.trim().split(`
`).map(H=>JSON.parse(H)),J=await Jt(g);await h(J),j(v.name),t(Pt(B))},E.readAsText(v)}function N(v){var I;v.preventDefault(),o(!1);const E=(I=v.dataTransfer)==null?void 0:I.files[0];E&&A(E)}function k(v){var g;const I=(g=v.target.files)==null?void 0:g[0];I&&A(I)}function m(v){a(v),oo(v)}function y(v){_(v),ro(v)}return l("div",{class:"container-fluid py-3",children:[l("div",{class:"trace-header d-flex align-items-center",children:[l("i",{class:"bi bi-diagram-3 me-2"}),l("span",{children:"AI Trace Viewer"})]}),l("div",{class:"controls-section",children:[l("div",{class:"row g-2 mb-2",children:[l("div",{class:"col-auto",children:l("select",{class:"form-select form-select-sm",value:i,onChange:U,disabled:p||s.length===0,children:[s.length===0&&l("option",{children:"Loading samples..."}),s.map(v=>l("option",{value:v.id,children:v.name},v.id))]})}),l("div",{class:"col-auto",children:l("button",{onClick:()=>R(i),class:"btn btn-primary btn-sm",disabled:p||!i,children:[l("i",{class:"bi bi-play-fill me-1"}),p?"Loading...":"Load"]})}),l("div",{class:"col-auto",children:l("input",{type:"file",accept:".jsonl,.ndjson",onChange:k,class:"form-control form-control-sm",style:{width:"200px"}})}),l("div",{class:"col-auto ms-auto d-flex gap-2",children:[l("button",{onClick:C,class:"btn btn-outline-secondary btn-sm",disabled:!e,title:"Clear expand/collapse state for current document",children:[l("i",{class:"bi bi-arrow-clockwise me-1"}),"Reset View"]}),l("button",{onClick:()=>{confirm("Clear all saved expand/collapse states for all documents?")&&w()},class:"btn btn-outline-danger btn-sm",title:"Clear all saved expand/collapse states",children:[l("i",{class:"bi bi-trash me-1"}),"Clear All States"]}),l(hs,{settings:u,onSettingsChange:y}),l(ms,{settings:f,onSettingsChange:m})]})]}),b&&l("div",{class:"text-muted small mb-2",children:[l("i",{class:"bi bi-file-text me-1"}),"Current file: ",l("strong",{children:b})]}),i&&s.find(v=>v.id===i)&&l("div",{class:"sample-info mb-2",children:[l("i",{class:`bi ${(x=s.find(v=>v.id===i))==null?void 0:x.icon} me-2 text-primary`}),l("small",{class:"text-muted",children:($=s.find(v=>v.id===i))==null?void 0:$.description})]}),l("div",{class:`upload-area ${n?"drag-active":""}`,onDrop:N,onDragOver:v=>{v.preventDefault(),o(!0)},onDragLeave:()=>o(!1),children:[l("i",{class:"bi bi-cloud-upload me-2"}),"Drop NDJSON/JSONL file here"]})]}),e&&l(fs,{forest:e,timestampSettings:f,densitySettings:u})]})}fe(l(vs,{}),document.getElementById("app"));
